<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Links</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <script type="module">
 import * as THREE from "https://unpkg.com/three@latest/build/three.module.js";

var camera, scene, renderer, raycaster, mouse;
var mouseX = 0, mouseY = 0;
var windowHalfX = window.innerWidth / 2;
var windowHalfY = window.innerHeight / 2;

async function fetchLinks() {
    const response = await fetch('info.json');
    const data = await response.json();
    console.log("Fetched links:", data);
    return data.Sheet1;
}

function createLinkTexture(title) {
    const canvas = document.createElement('canvas');
    canvas.width = 1012;
    canvas.height = 128;
    const context = canvas.getContext('2d');
    context.fillStyle = "#FFFFFF";
    // context.fillRect(0, 0, canvas.width, canvas.height);
    context.fillStyle = "#000000";
    context.font = '48px Arial';
    context.fillText(title, 10, 80);
    return new THREE.CanvasTexture(canvas);
}

async function init() {
    const linksData = await fetchLinks();

    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
    camera.position.z = 800;

    raycaster = new THREE.Raycaster();
    mouse = new THREE.Vector2();

    scene = new THREE.Scene();

    // Determine background color based on the time of day
    const currentHour = new Date().getHours();
    const factor = (Math.sin((Math.PI * currentHour) / 24) + 1) / 2;
    scene.background = new THREE.Color(factor, factor, factor);

    linksData.forEach(entry => {
        const texture = createLinkTexture(entry.title); // Change entry.link to entry.title
        const material = new THREE.SpriteMaterial({ map: texture });
        const sprite = new THREE.Sprite(material);
        sprite.scale.set(200, 50, 1);
        sprite.position.set(Math.random() * 1000 - 500, Math.random() * 1000 - 500, Math.random() * 1000 - 500);
        sprite.userData = { url: entry.link };
        scene.add(sprite);
    });

    renderer = new THREE.WebGLRenderer();
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    document.addEventListener('mousemove', onDocumentMouseMove, false);
    document.addEventListener('click', onDocumentClick, false);
    window.addEventListener('resize', onWindowResize, false);
}

function onWindowResize() {
    windowHalfX = window.innerWidth / 2;
    windowHalfY = window.innerHeight / 2;
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function onDocumentMouseMove(event) {
    mouseX = (event.clientX - windowHalfX);
    mouseY = (event.clientY - windowHalfY);

    // Normalize mouse position to -1 to +1 range
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

    raycaster.setFromCamera(mouse, camera);
    
    var intersects = raycaster.intersectObjects(scene.children);
    
    if (intersects.length > 0 && intersects[0].object.userData.url) {
        document.body.style.cursor = 'pointer';
    } else {
        document.body.style.cursor = 'default';
    }
}

function onDocumentClick() {
    raycaster.setFromCamera(mouse, camera);
    var intersects = raycaster.intersectObjects(scene.children);
    if (intersects.length > 0 && intersects[0].object.userData.url) {
        window.open(intersects[0].object.userData.url, '_blank');
    }
}

function animate() {
    requestAnimationFrame(animate);
    camera.position.x += (mouseX - camera.position.x) * 0.01;
    camera.position.y += (-mouseY - camera.position.y) * 0.01;
    camera.lookAt(scene.position);
    render();
}

function render() {
    renderer.render(scene, camera);
}

init().then(() => {
    animate();
});

  </script> 
  </body>
</html>
